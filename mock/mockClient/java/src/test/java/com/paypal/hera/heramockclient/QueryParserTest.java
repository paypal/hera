package com.paypal.hera.heramockclient;

import com.paypal.hera.parser.QueryParser;
import org.junit.Assert;
import org.junit.Test;

import java.util.HashMap;
import java.util.Map;

public class QueryParserTest {
    @Test
    public void testBasicRequestRead() throws Exception{
        String sql = "SELECT /* FOOMap.LOAD_BULK_SEQUENCE.-2 */ A.dbid , ppid_64_seq.NEXTVAL FROM IDTABLE A, WMULTIPLE_SEQ_VALUES_ANCHOR WHERE ROWNUM<= :p1";
        String mock = "HERAMOCK_OBJECT_MOCK_META DBID_START_HERA_MOCK 6:3 DBID,3:3 2,3:3 0,3:3 0,5:3 129,DBID_END_HERA_MOCK NEXT_VAL_START_HERA_MOCK 10:3 NEXT_VAL,3:3 2,3:3 0,3:3 0,5:3 129,NEXT_VAL_END_HERA_MOCK ROW_NUM_START_HERA_MOCK 9:3 ROW_NUM,3:3 2,3:3 0,3:3 0,5:3 129,ROW_NUM_END_HERA_MOCK SEQ_ID_START_HERA_MOCK 8:3 SEQ_ID,3:3 2,3:3 0,3:3 0,5:3 129,SEQ_ID_END_HERA_MOCK  NEXT_NEWSTRING DBID_START_HERA_MOCK 100 DBID_END_HERA_MOCK NEXT_VAL_START_HERA_MOCK 101 NEXT_VAL_END_HERA_MOCK ROW_NUM_START_HERA_MOCK 103 ROW_NUM_END_HERA_MOCK SEQ_ID_START_HERA_MOCK 102 SEQ_ID_END_HERA_MOCK  NEXT_NEWSTRING ,";
        System.out.println(QueryParser.getMockRowsForQuery(sql, mock, false));
        sql = "SELECT /* FOOMap.LOAD_BULK_SEQUENCE.-2 */ A.dbid , ppid_64_seq.NEXTVAL FROM IDTABLE A, WMULTIPLE_SEQ_VALUES_ANCHOR WHERE ROWNUM<= :p1";
        mock = "HERAMOCK_OBJECT_MOCK_META DBID_START_HERA_MOCK 6:3 DBID,3:3 2,3:3 0,3:3 0,5:3 129,DBID_END_HERA_MOCK NEXT_VAL_START_HERA_MOCK 10:3 NEXT_VAL,3:3 2,3:3 0,3:3 0,5:3 129,NEXT_VAL_END_HERA_MOCK ROW_NUM_START_HERA_MOCK 9:3 ROW_NUM,3:3 2,3:3 0,3:3 0,5:3 129,ROW_NUM_END_HERA_MOCK SEQ_ID_START_HERA_MOCK 8:3 SEQ_ID,3:3 2,3:3 0,3:3 0,5:3 129,SEQ_ID_END_HERA_MOCK  NEXT_NEWSTRING DBID_START_HERA_MOCK 100 DBID_END_HERA_MOCK NEXT_VAL_START_HERA_MOCK 101 NEXT_VAL_END_HERA_MOCK ROW_NUM_START_HERA_MOCK 103 ROW_NUM_END_HERA_MOCK SEQ_ID_START_HERA_MOCK 102 SEQ_ID_END_HERA_MOCK  NEXT_NEWSTRING ,";
        System.out.println(QueryParser.getMockMetaForQuery(sql, mock));

        sql = "SELECT /* FooMap.GETSOMETHING.-2 */ W.ADJUDICATION_STATUS_CODE, W.CHECK_TYPE, W.TRANSACTION_STATUS_CODE, W.ADJUDICATION_ACTOR_INFO_CODE, W.CHECKPOINT, W.PAYMENT_ID_P20, W.PLANNING_ID, W.SCAN_ACTOR_INFO_CODE, W.CHECK_ID, W.PAYMENT_ID, W.RECEIVER_ACCOUNT_NUMBER, W.RECEIVER_TRANSACTION_ID, W.SENDER_ACCOUNT_NUMBER, W.SENDER_TRANSACTION_ID, W.FLAGS, W.ID, W.PAYMENT_FLOW_ID, W.TIME_CREATED, W.TIME_UPDATED FROM FOO W WHERE W.PAYMENT_ID = :payment_id AND W.CHECK_TYPE = :check_type AND ((1 = 1))";
        mock = "HERAMOCK_OBJECT_MOCK_META END_TIME_START_HERA_MOCK 10:3 END_TIME,3:3 2,3:3 0,3:3 0,5:3 129,END_TIME_END_HERA_MOCK START_TIME_START_HERA_MOCK 12:3 START_TIME,3:3 2,3:3 0,3:3 0,5:3 129,START_TIME_END_HERA_MOCK FLAGS_START_HERA_MOCK 7:3 FLAGS,3:3 2,3:3 0,3:3 0,5:3 129,FLAGS_END_HERA_MOCK PAYMENT_FLOW_ID_START_HERA_MOCK 17:3 PAYMENT_FLOW_ID,3:3 2,3:3 0,3:3 0,5:3 129,PAYMENT_FLOW_ID_END_HERA_MOCK CHECKPOINT_START_HERA_MOCK 12:3 CHECKPOINT,3:3 1,3:3 8,3:3 0,3:3 0,CHECKPOINT_END_HERA_MOCK PLANNING_ID_START_HERA_MOCK 13:3 PLANNING_ID,3:3 1,3:3 8,3:3 0,3:3 0,PLANNING_ID_END_HERA_MOCK PAYMENT_ID_P20_START_HERA_MOCK 16:3 PAYMENT_ID_P20,3:3 1,3:3 8,3:3 0,3:3 0,PAYMENT_ID_P20_END_HERA_MOCK TIME_UPDATED_START_HERA_MOCK 14:3 TIME_UPDATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_UPDATED_END_HERA_MOCK TIME_CREATED_START_HERA_MOCK 14:3 TIME_CREATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_CREATED_END_HERA_MOCK ADJUDICATION_STATUS_CODE_START_HERA_MOCK 26:3 ADJUDICATION_STATUS_CODE,3:3 1,3:3 8,3:3 0,3:3 0,ADJUDICATION_STATUS_CODE_END_HERA_MOCK ADJUDICATION_ACTOR_INFO_CODE_START_HERA_MOCK 30:3 ADJUDICATION_ACTOR_INFO_CODE,3:3 1,3:3 8,3:3 0,3:3 0,ADJUDICATION_ACTOR_INFO_CODE_END_HERA_MOCK SCAN_ACTOR_INFO_CODE_START_HERA_MOCK 22:3 SCAN_ACTOR_INFO_CODE,3:3 1,3:3 8,3:3 0,3:3 0,SCAN_ACTOR_INFO_CODE_END_HERA_MOCK TRANSACTION_STATUS_CODE_START_HERA_MOCK 25:3 TRANSACTION_STATUS_CODE,3:3 1,3:3 8,3:3 0,3:3 0,TRANSACTION_STATUS_CODE_END_HERA_MOCK CHECK_ID_START_HERA_MOCK 10:3 CHECK_ID,3:3 2,3:3 0,3:3 0,5:3 129,CHECK_ID_END_HERA_MOCK CHECK_TYPE_START_HERA_MOCK 12:3 CHECK_TYPE,3:3 1,3:3 8,3:3 0,3:3 0,CHECK_TYPE_END_HERA_MOCK SENDER_ACCOUNT_NUMBER_START_HERA_MOCK 23:3 SENDER_ACCOUNT_NUMBER,3:3 2,3:3 0,3:3 0,5:3 129,SENDER_ACCOUNT_NUMBER_END_HERA_MOCK RECEIVER_ACCOUNT_NUMBER_START_HERA_MOCK 25:3 RECEIVER_ACCOUNT_NUMBER,3:3 2,3:3 0,3:3 0,5:3 129,RECEIVER_ACCOUNT_NUMBER_END_HERA_MOCK SENDER_TRANSACTION_ID_START_HERA_MOCK 23:3 SENDER_TRANSACTION_ID,3:3 2,3:3 0,3:3 0,5:3 129,SENDER_TRANSACTION_ID_END_HERA_MOCK RECEIVER_TRANSACTION_ID_START_HERA_MOCK 25:3 RECEIVER_TRANSACTION_ID,3:3 2,3:3 0,3:3 0,5:3 129,RECEIVER_TRANSACTION_ID_END_HERA_MOCK PAYMENT_ID_START_HERA_MOCK 12:3 PAYMENT_ID,3:3 2,3:3 0,3:3 0,5:3 129,PAYMENT_ID_END_HERA_MOCK ID_START_HERA_MOCK 4:3 ID,3:3 2,3:3 0,3:3 0,5:3 129,ID_END_HERA_MOCK  NEXT_NEWSTRING END_TIME_START_HERA_MOCK 0 END_TIME_END_HERA_MOCK START_TIME_START_HERA_MOCK 0 START_TIME_END_HERA_MOCK FLAGS_START_HERA_MOCK 0 FLAGS_END_HERA_MOCK PAYMENT_FLOW_ID_START_HERA_MOCK 0 PAYMENT_FLOW_ID_END_HERA_MOCK TIME_UPDATED_START_HERA_MOCK 0 TIME_UPDATED_END_HERA_MOCK TIME_CREATED_START_HERA_MOCK 0 TIME_CREATED_END_HERA_MOCK ADJUDICATION_STATUS_CODE_START_HERA_MOCK R ADJUDICATION_STATUS_CODE_END_HERA_MOCK ID_START_HERA_MOCK 0 ID_END_HERA_MOCK  NEXT_NEWSTRING ,";
        String resp = QueryParser.getMockRowsForQuery(sql, mock, false);
        for(String r : resp.split(" NEXT_NEWSTRING "))
            System.out.println(r);

        mock = "HERAMOCK_OBJECT_MOCK_META LAST_TIME_CLOSED_START_OCC_MOCK 18:3 LAST_TIME_CLOSED,3:3 2,3:3 0,3:3 0,5:3 129,LAST_TIME_CLOSED_END_OCC_MOCK TIME_CREATED_START_OCC_MOCK 14:3 TIME_CREATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_CREATED_END_OCC_MOCK TIME_UPDATED_START_OCC_MOCK 14:3 TIME_UPDATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_UPDATED_END_OCC_MOCK LAST_TIME_OPENED_START_OCC_MOCK 18:3 LAST_TIME_OPENED,3:3 2,3:3 0,3:3 0,5:3 129,LAST_TIME_OPENED_END_OCC_MOCK DISPOSITION_START_OCC_MOCK 13:3 DISPOSITION,3:3 1,3:3 8,3:3 0,3:3 0,DISPOSITION_END_OCC_MOCK ACCOUNT_NUMBER_ENC_START_OCC_MOCK 20:3 ACCOUNT_NUMBER_ENC,3:3 1,3:3 8,3:3 0,3:3 0,ACCOUNT_NUMBER_ENC_END_OCC_MOCK NAME_START_OCC_MOCK 6:3 NAME,3:3 1,3:3 8,3:3 0,3:3 0,NAME_END_OCC_MOCK UPDATE_VERSION_START_OCC_MOCK 16:3 UPDATE_VERSION,3:3 2,3:3 0,3:3 0,5:3 129,UPDATE_VERSION_END_OCC_MOCK PP_LEGAL_ENTITY_START_OCC_MOCK 17:3 PP_LEGAL_ENTITY,3:3 1,3:3 8,3:3 0,3:3 0,PP_LEGAL_ENTITY_END_OCC_MOCK SCUTTLE_ID_START_OCC_MOCK 12:3 SCUTTLE_ID,3:3 2,3:3 0,3:3 0,5:3 129,SCUTTLE_ID_END_OCC_MOCK REQUIRED_SECURITY_LEVEL_START_OCC_MOCK 25:3 REQUIRED_SECURITY_LEVEL,3:3 2,3:3 0,3:3 0,5:3 129,REQUIRED_SECURITY_LEVEL_END_OCC_MOCK ACCOUNT_NUMBER_START_OCC_MOCK 16:3 ACCOUNT_NUMBER,3:3 2,3:3 0,3:3 0,5:3 129,ACCOUNT_NUMBER_END_OCC_MOCK COUNTRY_CODE_START_OCC_MOCK 14:3 COUNTRY_CODE,3:3 1,3:3 8,3:3 0,3:3 0,COUNTRY_CODE_END_OCC_MOCK  NEXT_NEWSTRING  NO_DATA_FOUND ,";
        sql = "SELECT /* Account.FIND_BY_ACCOUNT_NUMBER */LAST_TIME_CLOSED, TIME_CREATED, TIME_UPDATED, LAST_TIME_OPENED, DISPOSITION, ACCOUNT_NUMBER_ENC, NAME, UPDATE_VERSION, PP_LEGAL_ENTITY, SCUTTLE_ID, REQUIRED_SECURITY_LEVEL, ACCOUNT_NUMBER, COUNTRY_CODE FROM ACCOUNT where ACCOUNT_NUMBER= :account_number";
        resp = QueryParser.getMockMetaForQuery(sql, mock);
        for(String r : resp.split(" NEXT_NEWSTRING ")) {
            System.out.println(r);
        }

    }

    @Test
    public void dummy() throws Exception{
        String sql = "SELECT /* FooMap.GETSOMETHING.-2 */ W.ADJUDICATION_STATUS_CODE, W.CHECK_TYPE, W.TRANSACTION_STATUS_CODE, W.ADJUDICATION_ACTOR_INFO_CODE, W.CHECKPOINT, W.PAYMENT_ID_P20, W.PLANNING_ID, W.SCAN_ACTOR_INFO_CODE, W.CHECK_ID, W.PAYMENT_ID, W.RECEIVER_ACCOUNT_NUMBER, W.RECEIVER_TRANSACTION_ID, W.SENDER_ACCOUNT_NUMBER, W.SENDER_TRANSACTION_ID, W.FLAGS, W.ID, W.PAYMENT_FLOW_ID, W.TIME_CREATED, W.TIME_UPDATED FROM FOO W WHERE W.PAYMENT_ID = :payment_id AND W.CHECK_TYPE = :check_type AND ((1 = 1))";

        String mock = "HERAMOCK_OBJECT_MOCK_META END_TIME_START_HERA_MOCK 10:3 END_TIME,3:3 2,3:3 0,3:3 0,5:3 129,END_TIME_END_HERA_MOCK START_TIME_START_HERA_MOCK 12:3 START_TIME,3:3 2,3:3 0,3:3 0,5:3 129,START_TIME_END_HERA_MOCK FLAGS_START_HERA_MOCK 7:3 FLAGS,3:3 2,3:3 0,3:3 0,5:3 129,FLAGS_END_HERA_MOCK PAYMENT_FLOW_ID_START_HERA_MOCK 17:3 PAYMENT_FLOW_ID,3:3 2,3:3 0,3:3 0,5:3 129,PAYMENT_FLOW_ID_END_HERA_MOCK CHECKPOINT_START_HERA_MOCK 12:3 CHECKPOINT,3:3 1,3:3 8,3:3 0,3:3 0,CHECKPOINT_END_HERA_MOCK PLANNING_ID_START_HERA_MOCK 13:3 PLANNING_ID,3:3 1,3:3 8,3:3 0,3:3 0,PLANNING_ID_END_HERA_MOCK PAYMENT_ID_P20_START_HERA_MOCK 16:3 PAYMENT_ID_P20,3:3 1,3:3 8,3:3 0,3:3 0,PAYMENT_ID_P20_END_HERA_MOCK TIME_UPDATED_START_HERA_MOCK 14:3 TIME_UPDATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_UPDATED_END_HERA_MOCK TIME_CREATED_START_HERA_MOCK 14:3 TIME_CREATED,3:3 2,3:3 0,3:3 0,5:3 129,TIME_CREATED_END_HERA_MOCK ADJUDICATION_STATUS_CODE_START_HERA_MOCK 26:3 ADJUDICATION_STATUS_CODE,3:3 1,3:3 8,3:3 0,3:3 0,ADJUDICATION_STATUS_CODE_END_HERA_MOCK ADJUDICATION_ACTOR_INFO_CODE_START_HERA_MOCK 30:3 ADJUDICATION_ACTOR_INFO_CODE,3:3 1,3:3 8,3:3 0,3:3 0,ADJUDICATION_ACTOR_INFO_CODE_END_HERA_MOCK SCAN_ACTOR_INFO_CODE_START_HERA_MOCK 22:3 SCAN_ACTOR_INFO_CODE,3:3 1,3:3 8,3:3 0,3:3 0,SCAN_ACTOR_INFO_CODE_END_HERA_MOCK TRANSACTION_STATUS_CODE_START_HERA_MOCK 25:3 TRANSACTION_STATUS_CODE,3:3 1,3:3 8,3:3 0,3:3 0,TRANSACTION_STATUS_CODE_END_HERA_MOCK CHECK_ID_START_HERA_MOCK 10:3 CHECK_ID,3:3 2,3:3 0,3:3 0,5:3 129,CHECK_ID_END_HERA_MOCK CHECK_TYPE_START_HERA_MOCK 12:3 CHECK_TYPE,3:3 1,3:3 8,3:3 0,3:3 0,CHECK_TYPE_END_HERA_MOCK SENDER_ACCOUNT_NUMBER_START_HERA_MOCK 23:3 SENDER_ACCOUNT_NUMBER,3:3 2,3:3 0,3:3 0,5:3 129,SENDER_ACCOUNT_NUMBER_END_HERA_MOCK RECEIVER_ACCOUNT_NUMBER_START_HERA_MOCK 25:3 RECEIVER_ACCOUNT_NUMBER,3:3 2,3:3 0,3:3 0,5:3 129,RECEIVER_ACCOUNT_NUMBER_END_HERA_MOCK SENDER_TRANSACTION_ID_START_HERA_MOCK 23:3 SENDER_TRANSACTION_ID,3:3 2,3:3 0,3:3 0,5:3 129,SENDER_TRANSACTION_ID_END_HERA_MOCK RECEIVER_TRANSACTION_ID_START_HERA_MOCK 25:3 RECEIVER_TRANSACTION_ID,3:3 2,3:3 0,3:3 0,5:3 129,RECEIVER_TRANSACTION_ID_END_HERA_MOCK PAYMENT_ID_START_HERA_MOCK 12:3 PAYMENT_ID,3:3 2,3:3 0,3:3 0,5:3 129,PAYMENT_ID_END_HERA_MOCK ID_START_HERA_MOCK 4:3 ID,3:3 2,3:3 0,3:3 0,5:3 129,ID_END_HERA_MOCK  NEXT_NEWSTRING END_TIME_START_HERA_MOCK 0 END_TIME_END_HERA_MOCK START_TIME_START_HERA_MOCK 0 START_TIME_END_HERA_MOCK FLAGS_START_HERA_MOCK 0 FLAGS_END_HERA_MOCK PAYMENT_FLOW_ID_START_HERA_MOCK 0 PAYMENT_FLOW_ID_END_HERA_MOCK TIME_UPDATED_START_HERA_MOCK 0 TIME_UPDATED_END_HERA_MOCK TIME_CREATED_START_HERA_MOCK 0 TIME_CREATED_END_HERA_MOCK ADJUDICATION_STATUS_CODE_START_HERA_MOCK R ADJUDICATION_STATUS_CODE_END_HERA_MOCK ID_START_HERA_MOCK 0 ID_END_HERA_MOCK  NEXT_NEWSTRING ,";
        String resp = QueryParser.getMockMetaForQuery(sql, mock);
        for(String r : resp.split(" NEXT_NEWSTRING "))
            System.out.println(r);
    }

    @Test
    public void specialCharTest() {

        Map<String, String> inp = new HashMap<>();

        inp.put("key", "value");
        inp.put("key&", "value");
        inp.put("key1", "val&ue");
        inp.put("ke=y1", "val&ue");
        inp.put("+=&", "&=+");
        inp.put("key2", "c++");
        inp.put("key2 H", "c++");


        for(String k : inp.keySet()) {
            HERAMockHelper.addMock(k, inp.get(k));
            String v = HERAMockHelper.getMock(k);
            System.out.println("Testing with key=" + k + " and value as " + v);
            Assert.assertEquals("Failed for " + k,
                    inp.get(k), v);
            HERAMockHelper.removeMock(k);
            Assert.assertNull(HERAMockHelper.getMock(k));
        }
    }
}
